<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js">
<!--<![endif]-->
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>書名辨識系統</title>
<meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js"></script>
</head>
<body>
<!--[if lt IE 7]>
            <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="#">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->
<h1 align="center">書名辨識系統<h1>
    
<form id="imgur">
<input type="file" class="imgur" accept="image/*" data-max-size="5000" />
</form>
<script>
            
   var imagetotextdata;
            
        $("document").ready(function () {
                    $('input[type=file]').on("change", function () {
                            var $files = $(this).get(0).files;
                            if ($files.length) {
                                // Reject big files
                                if ($files[0].size > $(this).data("max-size") * 1024) {
                                    console.log("Please select a smaller file");
                                    return false;
                                }
                                // Replace ctrlq with your own API key
                                var apiUrl = 'https://api.imgur.com/3/image';
                                //var apiUrl = 'https://api.mashiro.top/imgur-api/3/image';
                                var apiKey = 'f4e0b34abb55c8d';
                                var formData = new FormData();
                                formData.append("image", $files[0]);
                                var settings = {
                                    "async": true,
                                    "crossDomain": true,
                                    "url": apiUrl,
                                    "method": "POST",
                                    "datatype": "json",
                                    "headers": {
                                        "Authorization": "Client-ID " + apiKey
                                    },
                                    "processData": false,
                                    "contentType": false,
                                    "data": formData,
                                    beforeSend: function (xhr) {
                                        console.log("資料處理中...");
                                        $('body').append('<p align="center" id="upload">資料處理中...</p>');
                                    },
                                    success: function (res) {
                                        var imgur_link = res.data.link.replace('https://i.imgur.com/',
                                            'https://static.mashiro.top/imgur/');
                                        console.log(res.data.link);
                                        console.log(imgur_link);
                                                
                    $.get("https://script.google.com/macros/s/AKfycbyKmiaoQghgvz5yCN4fFa0FXpkWEaeuAyR-tSPUgFHxYZFrvvo/exec",{ 
                                         "imageurl":  imgur_link,
                                         
                    function (data) {
                                        
                                        document.getElementById("upload").innerHTML="資料處理完成";
                                        $('body').append('<p align="center" >圖片網址：' + imgur_link + '</p>');
                                        $('body').append('<p align="center" ><img  width="70%" src="' + imgur_link + '" /></p>');
                               
                               $.get("https://script.google.com/macros/s/AKfycbynWVYCwhCGpDUAG_wemOXj9oylNdemHbuSs0jarcwCSbfS7kM/exec", function(data) {
                
                    }
                      });    
                    });
                                            },
                                            error: function () {
                                                alert("上傳失敗");
                                            }
                                    }
                                    $.ajax(settings).done(function (response) {
                                        console.log("Done");
                                    });
                                }
                            });
                 
                    });
    </script>
</body>
