<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js">
<!--<![endif]-->
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>書名辨識系統</title>
<meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
</head>
<body>
<!--[if lt IE 7]>
            <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="#">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->
<h1 align="center">書名辨識系統<h1>
    
<form id="imgur">
<input type="file" class="imgur" accept="image/*" data-max-size="5000" />
</form>
            
<script>
            
    var parameter = {};
     parameter = {
            startRow: x,
            startColumn: 2
                    };      
            

            
        $("document").ready(function () {
                    $('input[type=file]').on("change", function () {
                            var $files = $(this).get(0).files;
                            if ($files.length) {
                                // Reject big files
                                if ($files[0].size > $(this).data("max-size") * 1024) {
                                    console.log("Please select a smaller file");
                                    return false;
                                }
                                // Replace ctrlq with your own API key
                                var apiUrl = 'https://api.imgur.com/3/image';
                                //var apiUrl = 'https://api.mashiro.top/imgur-api/3/image';
                                var apiKey = 'f4e0b34abb55c8d';
                                var formData = new FormData();
                                formData.append("image", $files[0]);
                                var settings = {
                                    "async": true,
                                    "crossDomain": true,
                                    "url": apiUrl,
                                    "method": "POST",
                                    "datatype": "json",
                                    "headers": {
                                        "Authorization": "Client-ID " + apiKey
                                    },
                                    "processData": false,
                                    "contentType": false,
                                    "data": formData,
                                    beforeSend: function (xhr) {
                                        console.log("資料處理中...");
                                        $('body').append('<p align="center" id="upload">資料處理中...</p>');
                                    },
                                    success: function (res) {
                                        var imgur_link = res.data.link.replace('https://i.imgur.com/',
                                            'https://static.mashiro.top/imgur/');
                                        console.log(res.data.link);
                                        console.log(imgur_link);
                                                
                    $.get("https://script.google.com/macros/s/AKfycbyKmiaoQghgvz5yCN4fFa0FXpkWEaeuAyR-tSPUgFHxYZFrvvo/exec",{ 
                                         "imageurl":  imgur_link,
                     
                       
                                
                    function (data) {     
                                        document.getElementById("upload").innerHTML="資料處理完成";
                                        $('body').append('<p align="center" >圖片網址：' + imgur_link + '</p>');
                                        $('body').append('<p align="center" ><img  width="70%" src="' + imgur_link + '" /></p>');
                                
                                
                                 var rankdata=[];
                                $.get("https://script.google.com/macros/s/AKfycbwgVZ6sftnho_eTei7TpjPmdIp_5wWjzdE8hZv6512Qm89EvOWm/exec", parameter, function(data) {
        
               rankdata=data.split(",");
               alert("共玩了:"+rankdata[20]+"次，平均時間:"+rankdata[21]+"秒\n第一名:"+rankdata[0]+"，花了"+rankdata[10]+"秒\n第二名:"+rankdata[1]+"，花了"+rankdata[11]+"秒\n第三名:"+rankdata[2]+"，花了"+rankdata[12]+"秒\n第四名:"+rankdata[3]+"，花了"+rankdata[13]+"秒\n第五名:"+rankdata[4]+"，花了"+rankdata[14]+"秒\n第六名:"+rankdata[5]+"，花了"+rankdata[15]+"秒\n第七名:"+rankdata[6]+"，花了"+rankdata[16]+"秒\n第八名:"+rankdata[7]+"，花了"+rankdata[17]+"秒\n第九名:"+rankdata[8]+"，花了"+rankdata[18]+"秒\n第十名:"+rankdata[9]+"，花了"+rankdata[19]+"秒");
        
      });
                                
                                
                              
                                
                    }
                                
                                
                                
                                
  
                    });
                                                
                                            },
                                            error: function () {
                                                alert("上傳失敗");
                                            }
                                    }
                                    $.ajax(settings).done(function (response) {
                                        console.log("Done");
                                    });
                                }
                            });
                   });
         
     parameter = {
            startRow: x,
            startColumn: 2
                    };         
            

              

           
    </script>
</body>
